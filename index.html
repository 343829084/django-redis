<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>django-redis documentation</title>
<link rel="stylesheet" href="static/niwi.css" type="text/css">
<link rel="stylesheet" href="static/pygments.css" type="text/css">


<script type="text/javascript" src="static/asciidoc.js"></script>
<script type="text/javascript" src="static/niwi.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article" style="max-width:800px">
<div id="header">
<h1>django-redis documentation</h1>
<span id="author">Andrey Antukh,</span><br>
<span id="email" class="monospaced">&lt;<a href="mailto:niwi@niwi.be">niwi@niwi.be</a>&gt;</span><br>
<span id="revnumber">version 3.6.2,</span>
<span id="revdate">2014-05-09</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p><em>django-redis</em> is a <a href="#license">BSD Licensed</a>, full featured Redis cache/session backend for Django.</p></div>
<div class="sect2">
<h3 id="_why_use_django_redis">1.1. Why use django-redis?</h3>
<div class="paragraph"><p>Because:</p></div>
<div class="ulist"><ul>
<li>
<p>
In active development.
</p>
</li>
<li>
<p>
Modular client system (pluggable clients).
</p>
</li>
<li>
<p>
Master-Slave support in the default client.
</p>
</li>
<li>
<p>
Complete battery of tests.
</p>
</li>
<li>
<p>
Used in production in several projects as cache and session storage.
</p>
</li>
<li>
<p>
Supports infinite timeouts.
</p>
</li>
<li>
<p>
Python 3 support in same code base.
</p>
</li>
<li>
<p>
Facilities for raw access to Redis client/connection pool.
</p>
</li>
<li>
<p>
Highly configurable (can emulate memcached exception behavior, for example).
</p>
</li>
<li>
<p>
Unix sockets supported by default.
</p>
</li>
<li>
<p>
Pluggable parsers.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_supported_versions">1.2. Supported versions</h3>
<div class="ulist"><ul>
<li>
<p>
Latest stable version: <strong>3.6.2</strong>
</p>
</li>
<li>
<p>
Previous stable version: <strong>3.5.2</strong>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_requirements">1.3. Requirements</h3>
<div class="ulist"><ul>
<li>
<p>
Python 2.7, 3.3 or 3.4
</p>
</li>
<li>
<p>
Django 1.4, 1.5, 1.6 and 1.7
</p>
</li>
<li>
<p>
redis-py &gt;= 2.9.0
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide">2. User guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation">2.1. Installation</h3>
<div class="paragraph"><p>The simplest way to use <strong>django-redis</strong> in your project is to install it with <strong>pip</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>pip install django-redis
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_configure_as_cache_backend">2.2. Configure as cache backend</h3>
<div class="paragraph"><p>To start using <strong>django-redis</strong>, you should change your Django cache settings to something like:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.cache.RedisCache&#39;</span><span class="p">,</span>
        <span class="s">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s">&#39;127.0.0.1:6379:1&#39;</span><span class="p">,</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;CLIENT_CLASS&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.client.DefaultClient&#39;</span><span class="p">,</span>
            <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;secretpassword&#39;</span><span class="p">,</span>  <span class="c"># Optional</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>In this example, we are using a standard TCP/IP socket connection to Redis running at <span class="monospaced">localhost</span>, using database 1.
In <span class="monospaced">OPTIONS</span>, we have specified the pluggable client we want to use; in this case the default one. You can omit
this part since that client is used by default if one is not specified.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you want use Unix sockets, change the <span class="monospaced">LOCATION</span> value to something like <span class="monospaced">"unix:/path/to/socket:1"</span>.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_as_session_backend">2.3. Configure as session backend</h3>
<div class="paragraph"><p>Django can by default use any cache backend as session backend and you benefit from that by using <strong>django-redis</strong>
as backend for session storage without installing any additional and unnecesary backends:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">SESSION_ENGINE</span> <span class="o">=</span> <span class="s">&#39;django.contrib.sessions.backends.cache&#39;</span>
<span class="n">SESSION_CACHE_ALIAS</span> <span class="o">=</span> <span class="s">&#39;default&#39;</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_usage">3. Advanced usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pickle_version">3.1. Pickle version</h3>
<div class="paragraph"><p>For almost all values, <strong>django-redis</strong> uses pickle to serialize objects and by default uses the
latest pickle protocol version. If you want set a custom version you can do it with the <span class="monospaced">PICKLE_VERSION</span> key
in <span class="monospaced">OPTIONS</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;PICKLE_VERSION&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>  <span class="c"># Use the latest protocol version</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_socket_timeout">3.2. Socket timeout</h3>
<div class="paragraph"><p>You can set socket timeout using the <span class="monospaced">SOCKET_TIMEOUT</span> key in the <span class="monospaced">OPTIONS</span> dict:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;SOCKET_TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c"># in seconds</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_memcached_exceptions_behavior">3.3. Memcached exceptions behavior</h3>
<div class="paragraph"><p>In some situations, when Redis is only used for cache, you do not want exceptions when Redis is down. This is
default behavior in the memcached backend and it can be emulated in <strong>django-redis</strong>.</p></div>
<div class="paragraph"><p>You can ignore exceptions globally (for all configured Redis cache clients) by setting <span class="monospaced">DJANGO_REDIS_IGNORE_EXCEPTIONS</span>
to <span class="monospaced">True</span> in your settings.</p></div>
<div class="paragraph"><p>Additionally, you can set it individually for each client in their <span class="monospaced">OPTIONS</span> dict:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;IGNORE_EXCEPTIONS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_infinite_timeout">3.4. Infinite timeout</h3>
<div class="paragraph"><p><strong>django-redis</strong> comes with infinite timeouts support, since before Django added it in version 1.6.</p></div>
<div class="paragraph"><p>If used with Django before version 1.6, <strong>django-redis</strong> interprets a <span class="monospaced">0</span> timeout value as infinite. In Django &gt;= 1.6 it also supports
<span class="monospaced">None</span> as timeout value.</p></div>
<div class="listingblock">
<div class="title">These statements are then equivalent:</div>
<div class="content"><div class="highlight"><pre><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_get_ttl_time_to_live_from_key">3.5. Get ttl (time-to-live) from key</h3>
<div class="paragraph"><p>With redis, you can access to ttl of any stored key, for it, django-redis exposes <span class="monospaced">ttl</span> function.</p></div>
<div class="paragraph"><p>It returns:</p></div>
<div class="ulist"><ul>
<li>
<p>
ttl value for any volatile key (any key that has expiration)
</p>
</li>
<li>
<p>
0 for expired and not existent keys
</p>
</li>
<li>
<p>
None for keys that does not have expiration
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="title">Simple search keys by pattern</div>
<div class="content"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span><span class="o">.</span><span class="n">ttl</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
<span class="go">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span><span class="o">.</span><span class="n">ttl</span><span class="p">(</span><span class="s">&#39;not-existent&#39;</span><span class="p">)</span>
<span class="go">0</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_scan_amp_delete_keys_in_bulk">3.6. Scan &amp; Delete keys in bulk</h3>
<div class="paragraph"><p><strong>django-redis</strong> comes with some additions methods that hels for search or delete keys
using glob patterns.</p></div>
<div class="listingblock">
<div class="title">Simple search keys by pattern</div>
<div class="content"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="s">&#39;foo_*&#39;</span><span class="p">)</span>
<span class="go">[&#39;foo_1&#39;, &#39;foo_2&#39;]</span>
</pre></div></div></div>
<div class="paragraph"><p>On simple, search it return all matched values, in databases with big amount of keys
this isn&#8217;t suitable method. For it, you can use <span class="monospaced">iter_keys</span> function that works like
<span class="monospaced">keys</span> function but uses redis&gt;=2.8 server side cursors.</p></div>
<div class="listingblock">
<div class="title">Search using server side cursors</div>
<div class="content"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span><span class="o">.</span><span class="n">iter_keys</span><span class="p">(</span><span class="s">&#39;foo_*&#39;</span><span class="p">)</span>
<span class="go">&lt;generator object algo at 0x7ffa9c2713a8&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">cache</span><span class="o">.</span><span class="n">iter_keys</span><span class="p">(</span><span class="s">&#39;foo_*&#39;</span><span class="p">))</span>
<span class="go">&quot;foo_1&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>For delete keys, you should use <span class="monospaced">delete_pattern</span> that has the same glob pattern syntax
like <span class="monospaced">keys</span> function and returns a number of deleted keys.</p></div>
<div class="listingblock">
<div class="title">Example use of delete_pattern</div>
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">delete_pattern</span><span class="p">(</span><span class="s">&#39;foo_*&#39;</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_redis_native_commands">3.7. Redis native commands</h3>
<div class="paragraph"><p><strong>django-redis</strong> has limited support for some Redis atomic operations, such as the commands <span class="monospaced">SETNX</span> and <span class="monospaced">INCR</span>.</p></div>
<div class="paragraph"><p>You can use the <span class="monospaced">SETNX command through the backend `set()</span> method with the <span class="monospaced">nx</span> parameter:</p></div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value1&#39;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;value2&#39;</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">)</span>
<span class="s">&#39;value1&#39;</span>
</pre></div></div></div>
<div class="paragraph"><p>Also, <span class="monospaced">incr</span> and <span class="monospaced">decr</span> methods uses redis atomic operations when value that contains a key is suitable
for it.</p></div>
</div>
<div class="sect2">
<h3 id="_raw_client_access">3.8. Raw client access</h3>
<div class="paragraph"><p>In some situations your application requires access to a raw Redis client to use some advanced
features that aren&#8217;t exposed by the Django cache interface. To avoid storing another setting for creating a raw
connection, <strong>django-redis</strong> exposes functions with which you can obtain a raw client reusing the cache connection
string: <span class="monospaced">get_redis_connection(alias)</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">redis_cache</span> <span class="kn">import</span> <span class="n">get_redis_connection</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">con</span> <span class="o">=</span> <span class="n">get_redis_connection</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">con</span>
<span class="o">&lt;</span><span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x2dc4510</span><span class="o">&gt;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Not all pluggable clients support this feature.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_connection_pools">3.9. Connection pools</h3>
<div class="paragraph"><p>Behind the scenes, <strong>django-redis</strong> uses the underlying <strong>redis-py</strong> connection pool implementation, and exposes a simple way to
configure it or directly customize a connection/connection pool creation for backend.</p></div>
<div class="paragraph"><p>The default <strong>redis-py</strong> behavior is to not close connections, recycling them when possible.</p></div>
<div class="sect3">
<h4 id="_configure_default_connection_pool">3.9.1. Configure default connection pool</h4>
<div class="paragraph"><p>The default connection pool is simple. You can only customize the maximum number of connections
in the pool, by setting <span class="monospaced">CONNECTION_POOL_KWARGS</span> in the <span class="monospaced">CACHES</span> setting:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.cache.RedisCache&#39;</span><span class="p">,</span>
        <span class="o">...</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;CONNECTION_POOL_KWARGS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;max_connections&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can verify how many connections the pool has opened with the following snippet:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">get_cache</span>
<span class="n">redis_cache</span> <span class="o">=</span> <span class="n">get_cache</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>  <span class="c"># Use the name you have defined for Redis in settings.CACHES</span>
<span class="n">redis</span> <span class="o">=</span> <span class="n">redis_cache</span><span class="o">.</span><span class="n">raw_client</span>
<span class="n">connection_pool</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">connection_pool</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Created connections so far: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">connection_pool</span><span class="o">.</span><span class="n">_created_connections</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_use_your_own_connection_pool_subclass">3.9.2. Use your own connection pool subclass</h4>
<div class="paragraph"><p>Sometimes you want to use your own subclass of the connection pool. This is possible with
<strong>django-redis</strong> using the <span class="monospaced">CONNECTION_POOL_CLASS</span> parameter in the backend options.</p></div>
<div class="listingblock">
<div class="title"><em>myproj/mypool.py</em></div>
<div class="content"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">redis.connection</span> <span class="kn">import</span> <span class="n">ConnectionPool</span>

<span class="k">class</span> <span class="nc">MyOwnPool</span><span class="p">(</span><span class="n">ConnectionPool</span><span class="p">):</span>
    <span class="c"># Just doing nothing, only for example purpose</span>
    <span class="k">pass</span>
</pre></div></div></div>
<div class="listingblock">
<div class="title"><em>settings.py</em></div>
<div class="content"><div class="highlight"><pre><span class="c"># Omitting all backend declaration boilerplate code.</span>

<span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;CONNECTION_POOL_CLASS&#39;</span><span class="p">:</span> <span class="s">&#39;myproj.mypool.MyOwnPool&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_customize_connection_factory">3.9.3. Customize connection factory</h4>
<div class="paragraph"><p>If none of the previous methods satisfies you, you can get in the middle of the <strong>django-redis</strong> connection
factory process and customize or completely rewrite it.</p></div>
<div class="paragraph"><p>By default, <strong>django-redis</strong> creates connections through the <span class="monospaced">redis_cache.pool.ConnectionFactory</span> class that is specified
in the global Django setting <span class="monospaced">DJANGO_REDIS_CONNECTION_FACTORY</span>.</p></div>
<div class="listingblock">
<div class="title">Partial interface of <span class="monospaced">ConnectionFactory</span> class</div>
<div class="content"><div class="highlight"><pre><span class="c"># Note: Using Python 3 notation for code documentation ;)</span>

<span class="k">class</span> <span class="nc">ConnectionFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_connection_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
        <span class="c"># Given connection parameters in the `params` argument,</span>
        <span class="c"># return new connection pool.</span>
        <span class="c"># It should be overwritten if you want do something</span>
        <span class="c"># before/after creating the connection pool, or return your</span>
        <span class="c"># own connection pool.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
        <span class="c"># Given connection parameters in the `params` argument,</span>
        <span class="c"># return a new connection.</span>
        <span class="c"># It should be overwritten if you want to do something</span>
        <span class="c"># before/after creating a new connection.</span>
        <span class="c"># The default implementation uses `get_connection_pool`</span>
        <span class="c"># to obtain a pool and create a new connection in the</span>
        <span class="c"># newly obtained pool.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_or_create_connection_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span><span class="nb">dict</span><span class="p">):</span>
        <span class="c"># This is a high layer on top of `get_connection_pool` for</span>
        <span class="c"># implementing a cache of created connection pools.</span>
        <span class="c"># It should be overwritten if you want change the default</span>
        <span class="c"># behavior.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">make_connection_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="c"># The responsibility of this method is to convert basic connection</span>
        <span class="c"># parameters and other settings to fully connection pool ready</span>
        <span class="c"># connection parameters.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
        <span class="c"># This is really a public API and entry point for this</span>
        <span class="c"># factory class. This encapsulates the main logic of creating</span>
        <span class="c"># the previously mentioned `params` using `make_connection_params`</span>
        <span class="c"># and creating a new connection using the `get_connection` method.</span>
        <span class="k">pass</span>
</pre></div></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_pluggable_parsers">3.10. Pluggable parsers</h3>
<div class="paragraph"><p><strong>redis-py</strong> (the Python Redis client used by <strong>django-redis</strong>) comes with a pure Python Redis parser that works very
well for most common task, but if you want some performance boost, you can use <strong>hiredis</strong>.</p></div>
<div class="paragraph"><p><strong>hiredis</strong> is a Redis client written in C and it has its own parser that can be used with <strong>django-redis</strong>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&#39;PARSER_CLASS&#39;</span><span class="p">:</span> <span class="s">&#39;redis.connection.HiredisParser&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_pluggable_clients">3.11. Pluggable clients</h3>
<div class="sect3">
<h4 id="_default_client">3.11.1. Default client</h4>
<div class="paragraph"><p>In addition to what has been explained previously, the default client comes with master-slave connection support. To
use master-slave configuration in your project, you should change your <span class="monospaced">LOCATION</span> value to something like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">&#39;127.0.0.1:6379:1&#39;</span><span class="p">,</span>
    <span class="s">&#39;127.0.0.1:6378:1&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Master-Slave setup is not heavily tested in production environments.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_shard_client">3.11.2. Shard client</h4>
<div class="paragraph"><p>This pluggable client implements client-side sharding. It inherits almost all functionality from
the default client. To use it, change your cache settings to something like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.cache.RedisCache&#39;</span><span class="p">,</span>
        <span class="s">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&#39;127.0.0.1:6379:1&#39;</span><span class="p">,</span>
            <span class="s">&#39;127.0.0.1:6379:2&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;CLIENT_CLASS&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.client.ShardClient&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">Shard client is still experimental, so be careful when using it in production environments.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_herd_client">3.11.3. Herd client</h4>
<div class="paragraph"><p>This pluggable client helps dealing with the thundering herd problem. You can read more about it
on <a href="http://en.wikipedia.org/wiki/Thundering_herd_problem">Wikipedia</a>.</p></div>
<div class="paragraph"><p>As with previous pluggable clients, it inherits all functionality from the default client, adding some additional
methods for getting/setting keys.</p></div>
<div class="listingblock">
<div class="title">Example setup</div>
<div class="content"><div class="highlight"><pre> <span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.cache.RedisCache&#39;</span><span class="p">,</span>
        <span class="s">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s">&#39;127.0.0.1:6379:1&#39;</span><span class="p">,</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;CLIENT_CLASS&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.client.HerdClient&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This client exposes additional settings:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">CACHE_HERD_TIMEOUT</span>: Set default herd timeout. (Default value: 60s)
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_auto_failover_client">3.11.4. Auto Failover client</h4>
<div class="paragraph"><p>This pluggable experimental client offers a simple failover algorithm if the main Redis server is down.</p></div>
<div class="paragraph"><p>To use it, you should change your cache settings to something like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.cache.RedisCache&#39;</span><span class="p">,</span>
        <span class="s">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s">&#39;127.0.0.1:6379:1/127.0.0.2:6379:1&#39;</span><span class="p">,</span>
        <span class="s">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;CLIENT_CLASS&#39;</span><span class="p">:</span> <span class="s">&#39;redis_cache.client.SimpleFailoverClient&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The big difference is that each key in the <span class="monospaced">LOCATION</span> setting list can contain two connection strings
separated by "/". A second connection string works as a failover server.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license">4. License</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Copyright (c) 2011-2014 Andrei Antoukh &lt;niwi@niwi.be&gt;
Copyright (c) 2011 Sean Bleier

All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
1. Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.
3. The name of the author may not be used to endorse or promote products
   derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#39;&#39; AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</pre></div></div></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 3.6.2<br>
Last updated 2014-05-09 22:30:18 CEST
</div>
</div>
</body>
</html>
